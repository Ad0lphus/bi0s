import png
 
filename = "image_decrypted_in_memorybymalware.png"
png_data = png.Reader(filename=filename).read()
img_data = list(png_data[2])
list1=[]
list2=[]
 

i = 0
while (i < len(img_data[0])):
    for i in range(0,len(img_data)-1):
        
        R = img_data[i][i]   
        G = img_data[i][i+1]  
        B = img_data[i][i+2]
        list1.append(R) 
        list1.append(G)
        list1.append(B)

    i += 4
decoded_data = list1[3:]

pos=16 
decoded_data2=decoded_data[pos:pos+len(decoded_data)]
for i in range(0,len(decoded_data2)):
    list2.append(decoded_data2[i] ^ decoded_data[i%16])
 
out1 = open ("out.bin", 'wb')
out1.write(bytearray(list2))
out1.close()